<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<mapper namespace="monitoringLocation">

    <resultMap id="monitoringLocationResult" type="GeoJSON">
        <result property="id" column="monitoring_location_identifier"/>
        <result property="desc" column="description"/>
        <result property="properties.samplingFeatureName" column="site_name"/>
        <result property="geometry.longitude" column="longitude"/>
        <result property="geometry.latitude" column="latitude"/>
    </resultMap>

    <select id="getGeoJson" parameterType="String" resultMap="monitoringLocationResult">
        select monitoring_location_identifier,
               site_name,
               to_char(st_y(geom),'FM90.0000000') latitude,
               to_char(st_x(geom),'FM990.0000000') longitude
          from (select monitoring_location_identifier,
                       site_name,
                       st_transform(geom, 4326) geom
                  from nwis.monitoring_location
                 where geom is not null and
                       site_identification_number = #{value,jdbcType=VARCHAR}) site_data
    </select>

</mapper>
